<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact Save — Two-step Form</title>

  <style>
    /* ====== Elegant Official CSS ====== */
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --accent:#0b63d6;
      --muted:#556077;
      --danger:#e11d48;
      --radius:14px;
      --shadow: 0 10px 34px rgba(16,24,40,0.08);
      font-family: "Inter", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    html,body{ height:100%; margin:0; background: linear-gradient(180deg,#f7fbff 0%, #fbfdff 100%); color:#0f172a; }
    body { -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; direction:ltr; }

    /* header occupying 45% of viewport height */
    header{
      height:45vh; /* requested header height */
      min-height:220px;
      background:linear-gradient(135deg, rgba(11,99,214,0.95), rgba(60,134,255,0.9));
      display:flex;
      align-items:center;
      justify-content:center;
      border-bottom-left-radius: 36px;
      border-bottom-right-radius: 36px;
      box-shadow: 0 12px 40px rgba(11,99,214,0.12);
      overflow:hidden;
      position:relative;
    }

    /* header image — provide large intrinsic size but scale responsively */
    header .hero-img{
      width:100%;
      height:100%;
      object-fit:cover;
      object-position:center;
      display:block;
      opacity:0.97;
      filter:brightness(0.95);
    }

    /* overlaying title block */
    header .title {
      position:absolute;
      left:32px;
      top:28px;
      color:white;
      text-shadow: 0 6px 22px rgba(6,10,20,0.28);
      z-index:3;
    }
    header .title h1{ margin:0; font-size:clamp(18px,3.2vw,36px); font-weight:700; }
    header .title p{ margin:6px 0 0 0; opacity:0.95; font-size:14px; }

    main{
      width:min(1100px,94%);
      margin:-5.5rem auto 60px; /* lift card above header */
      position:relative;
    }

    .card{
      background:var(--card);
      border-radius:18px;
      padding:28px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .steps{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:18px;
    }
    .step-pill{
      padding:8px 14px;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(11,99,214,0.06), rgba(11,99,214,0.02));
      border:1px solid rgba(11,99,214,0.06);
      color:var(--accent);
      font-weight:700;
      font-size:14px;
    }

    form .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:14px;
    }
    label{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
      font-weight:600;
    }
    input[type="text"], input[type="tel"], select{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e6e9ef;
      background:#fbfdff;
      outline:none;
      font-size:14px;
      box-sizing:border-box;
    }
    input[type="text"]:focus, input[type="tel"]:focus, select:focus {
      border-color: rgba(11,99,214,0.6);
      box-shadow: 0 6px 18px rgba(11,99,214,0.06);
    }

    .full { grid-column: 1 / -1; }
    .actions {
      display:flex;
      gap:12px;
      justify-content:space-between;
      align-items:center;
      margin-top:16px;
    }

    .btn {
      padding:10px 18px;
      border-radius:10px;
      font-weight:700;
      border: none;
      cursor:pointer;
      font-size:14px;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .btn-primary{
      background: linear-gradient(90deg,var(--accent), #2f82ff);
      color:white;
      box-shadow: 0 8px 24px rgba(11,99,214,0.18);
    }
    .btn-ghost {
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(11,99,214,0.12);
    }
    .btn-disabled{
      opacity:0.6;
      pointer-events:none;
    }

    .small-note{ font-size:13px; color:var(--muted); }

    .address-section{
      border-top:1px dashed #eef6ff;
      margin-top:18px;
      padding-top:18px;
    }

    .error-inline {
      color:var(--danger);
      font-size:13px;
      margin-top:6px;
      display:none;
    }
    .input-error {
      border-color:var(--danger) !important;
      box-shadow: 0 6px 18px rgba(225,29,72,0.08);
    }

    /* loading overlay */
    .overlay {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(8,12,26,0.36);
      z-index:9999;
      visibility:hidden;
      opacity:0;
      transition:opacity 220ms ease, visibility 220ms;
    }
    .overlay.show {
      visibility:visible;
      opacity:1;
    }
    .loader-box{
      background:white;
      padding:20px 26px;
      border-radius:12px;
      display:flex;
      gap:14px;
      align-items:center;
      box-shadow:0 12px 36px rgba(2,6,23,0.16);
    }
    .loader-box img { width:42px; height:42px; }
    .loader-box .txt { font-weight:700; color:#0f172a; }

    footer{ text-align:center; color:var(--muted); margin-top:18px; font-size:13px; }

    /* Nice modal for errors */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(2,6,23,0.45);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10010;
      visibility:hidden;
      opacity:0;
      transition:opacity 180ms ease, visibility 180ms;
    }
    .modal-backdrop.show{ visibility:visible; opacity:1; }
    .modal {
      width: min(520px, calc(100% - 36px));
      background:white;
      border-radius:12px;
      padding:20px;
      box-shadow: 0 20px 60px rgba(2,6,23,0.18);
      text-align:left;
    }
    .modal h3{ margin:0 0 8px 0; font-size:18px; color:#0f172a; }
    .modal p{ margin:0 0 14px 0; color:#374151; font-size:14px; }
    .modal .modal-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:10px; }
    .modal .btn-cancel{ background:#f3f4f6; color:#111827; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }

    /* responsive */
    @media (max-width:820px){
      .grid{ grid-template-columns: 1fr; }
      header{ height:34vh; }
      main{ margin-top:-3rem; }
      header .title{ left:18px; top:16px; }
    }
  </style>
</head>
<body>

  <header>
    <!-- large image container — replace src with your actual image file or URL -->
    <!-- Intrinsic image size attributes set to width=4767 and height=1200 per request -->
    <img class="hero-img" src="header-image.jpg" alt="Header Image" width="4767" height="1200" />
    <div class="title" aria-hidden="false">
      <h1>Contact Registration — Two-step</h1>
      <p>Fill in Step 1, then complete the address in Step 2.</p>
    </div>
  </header>

  <main>
    <div class="card" role="main" aria-labelledby="formTitle">
      <div class="steps">
        <div class="step-pill">Step 1 — Details</div>
        <div class="step-pill" style="opacity:0.6">Step 2 — Address</div>
      </div>

      <form id="contactForm" autocomplete="off" novalidate>
        <!-- STEP 1 -->
        <div id="step1">
          <div class="grid">
            <div>
              <label for="firstName">First Name</label>
              <input id="firstName" name="firstName" type="text" placeholder="e.g. John" required />
            </div>
            <div>
              <label for="lastName">Last Name</label>
              <input id="lastName" name="lastName" type="text" placeholder="e.g. Doe" required />
            </div>

            <div>
              <label for="phone">Phone Number</label>
              <input id="phone" name="phone" type="tel" placeholder="+1 555 555 5555" required />
            </div>

            <div>
              <label for="dob">Date of Birth (Year / Month)</label>
              <div style="display:flex; gap:10px;">
                <select id="dobYear" required>
                  <option value="">Year</option>
                </select>
                <select id="dobMonth" required>
                  <option value="">Month</option>
                </select>
              </div>
            </div>

            <div class="full">
              <label for="nic">National ID / Unique Code</label>
              <input id="nic" name="nic" type="text" placeholder="ID / Unique code" />
            </div>
          </div>

          <div class="actions">
            <div style="display:flex;gap:8px;">
              <button type="button" class="btn btn-ghost" id="btnStep1Prev" disabled>Back</button>
              <button type="button" class="btn btn-primary" id="btnToStep2">Save & Continue</button>
            </div>
            <div class="small-note">Please ensure phone number is entered correctly.</div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div id="step2" style="display:none; margin-top:14px;">
          <div class="address-section">
            <div class="grid">
              <div>
                <label for="street">Street / Alley</label>
                <input id="street" name="street" type="text" placeholder="Street and alley" />
              </div>
              <div>
                <label for="city">City</label>
                <input id="city" name="city" type="text" placeholder="City" />
              </div>

              <div>
                <label for="state">Province / State</label>
                <input id="state" name="state" type="text" placeholder="Province or state" />
              </div>

              <div>
                <label for="country">Country</label>
                <input id="country" name="country" type="text" placeholder="Country" value="Afghanistan" />
              </div>

              <div>
                <label for="contactPhone">Contact Phone (for address)</label>
                <input id="contactPhone" name="contactPhone" type="tel" placeholder="+1 555 555 5555" />
              </div>

              <div>
                <label for="postal">Postal Code</label>
                <input id="postal" name="postal" type="text" placeholder="e.g. 1001" />
                <div id="postalError" class="error-inline">Postal code appears invalid.</div>
              </div>

              <div class="full">
                <label for="notes">Notes</label>
                <input id="notes" name="notes" type="text" placeholder="Additional notes (optional)" />
              </div>
            </div>

            <div style="display:flex; gap:12px; margin-top:16px;">
              <!-- Button that performs no client-side navigation but still sends to Google Sheet -->
              <button type="button" class="btn btn-ghost" id="btnSaveNoAction">Send to Google Sheet (No Redirect)</button>

              <!-- Save + redirect button -->
              <button type="button" class="btn btn-primary" id="btnSaveAndRedirect">Save & Finish</button>
            </div>

            <div style="margin-top:12px;">
              <small class="small-note">After saving successfully, a 10-second loading animation will be shown and then you will be redirected.</small>
            </div>
          </div>
        </div>
      </form>

      <footer>Form ready — replace the webapp URL and header image before publishing.</footer>
    </div>
  </main>

  <!-- overlay loading -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="loader-box" role="status" aria-live="polite">
      <!-- small inline spinner -->
      <img src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwv///wAAACH5BAEAAAEALAAAAAAQABAAAAIgjI+py+0Po5y02ouz3rz7D4biSJbmmiabqyrbuC8fyr3sFADs=" alt="loading" />
      <div class="txt">Saving... Please wait</div>
    </div>
  </div>

  <!-- modal for errors -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Error</h3>
      <p id="modalMessage">There was an error.</p>
      <div class="modal-actions">
        <button class="btn-cancel" id="modalClose">Close</button>
      </div>
    </div>
  </div>

  <script>
    /* ====== JavaScript ====== */

    // === CONFIG - replace with your deployed Google Apps Script web app URL and redirect URL ===
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyvVnohGoXJptGned88e3JMPD0i3RqyCv80E_0e8_q8NmotYg-e-q2OPTevX2eAasym7A/exec"; // <-- replace
    const REDIRECT_URL_AFTER_SUCCESS = "https://www.facebook.com/"; // destination after success
    // =======================================================================================

    // populate Year and Month selects
    (function populateDOB(){
      const yearSelect = document.getElementById('dobYear');
      const monthSelect = document.getElementById('dobMonth');
      const currentYear = new Date().getFullYear();
      for (let y = currentYear; y >= 1900; y--) {
        const opt = document.createElement('option');
        opt.value = y;
        opt.textContent = y;
        yearSelect.appendChild(opt);
      }
      const months = [
        {v:'01',t:'01'}, {v:'02',t:'02'}, {v:'03',t:'03'}, {v:'04',t:'04'},
        {v:'05',t:'05'}, {v:'06',t:'06'}, {v:'07',t:'07'}, {v:'08',t:'08'},
        {v:'09',t:'09'}, {v:'10',t:'10'}, {v:'11',t:'11'}, {v:'12',t:'12'}
      ];
      months.forEach(m=>{
        const opt = document.createElement('option');
        opt.value = m.v;
        opt.textContent = m.t;
        monthSelect.appendChild(opt);
      });
    })();

    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const btnToStep2 = document.getElementById('btnToStep2');
    const btnSaveNoAction = document.getElementById('btnSaveNoAction');
    const btnSaveAndRedirect = document.getElementById('btnSaveAndRedirect');
    const overlay = document.getElementById('overlay');
    const postalInput = document.getElementById('postal');
    const postalError = document.getElementById('postalError');

    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalMessage = document.getElementById('modalMessage');
    const modalClose = document.getElementById('modalClose');

    modalClose.addEventListener('click', hideModal);
    modalBackdrop.addEventListener('click', function(e){
      if (e.target === modalBackdrop) hideModal();
    });

    function showModal(title, message){
      document.getElementById('modalTitle').textContent = title || 'Error';
      modalMessage.textContent = message || 'An error occurred.';
      modalBackdrop.classList.add('show');
      modalBackdrop.setAttribute('aria-hidden','false');
    }
    function hideModal(){
      modalBackdrop.classList.remove('show');
      modalBackdrop.setAttribute('aria-hidden','true');
    }

    // Validate Step1 fields
    function validateStep1(){
      const fn = document.getElementById('firstName').value.trim();
      const ln = document.getElementById('lastName').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const year = document.getElementById('dobYear').value;
      const month = document.getElementById('dobMonth').value;
      if(!fn || !ln || !phone || !year || !month){
        showModal('Missing Fields', 'Please complete all Step 1 fields (first name, last name, phone, year and month of birth).');
        return false;
      }
      return true;
    }

    btnToStep2.addEventListener('click', ()=>{
      if (!validateStep1()) return;
      step1.style.display = 'none';
      step2.style.display = 'block';
      document.querySelector('.steps .step-pill:nth-child(2)').style.opacity = 1;
      document.querySelector('.steps .step-pill:nth-child(1)').style.opacity = 0.6;
    });

    function collectFormData(){
      return {
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        dobYear: document.getElementById('dobYear').value,
        dobMonth: document.getElementById('dobMonth').value,
        nic: document.getElementById('nic').value.trim(),
        street: document.getElementById('street').value.trim(),
        city: document.getElementById('city').value.trim(),
        state: document.getElementById('state').value.trim(),
        country: document.getElementById('country').value.trim(),
        contactPhone: document.getElementById('contactPhone').value.trim(),
        postal: document.getElementById('postal').value.trim(),
        notes: document.getElementById('notes').value.trim(),
        submittedAt: new Date().toISOString()
      };
    }

    // POST to Google Apps Script webapp
    async function postToSheet(data){
      try{
        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          mode: 'cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const json = await res.json();
        return json;
      }catch(err){
        return { status:'error', message: err.message || 'Network error' };
      }
    }

    // show overlay for exactly 10 seconds
    function showLoadingForTenSeconds(){
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden','false');
      return new Promise(resolve=>{
        setTimeout(()=> {
          overlay.classList.remove('show');
          overlay.setAttribute('aria-hidden','true');
          resolve();
        }, 10000);
      });
    }

    // Postal simple pattern check
    function validatePostal(postal){
      if(!postal) return true; // allow empty
      // allow alphanumeric and dash, length 3-10
      return /^[0-9A-Za-z\-]{3,10}$/.test(postal);
    }

    // Send to sheet without redirect
    btnSaveNoAction.addEventListener('click', async ()=>{
      const data = collectFormData();
      // client-side postal check
      if(!validatePostal(data.postal)){
        postalError.style.display = 'block';
        postalInput.classList.add('input-error');
        showModal('Postal Code Error', 'The postal code format appears invalid. Please correct it.');
        return;
      } else {
        postalError.style.display = 'none';
        postalInput.classList.remove('input-error');
      }

      const resp = await postToSheet({...data, action:'save_no_action'});
      if(resp && resp.status === 'ok'){
        showModal('Saved', 'Data successfully sent to Google Sheets. No redirect was performed.');
      } else {
        showModal('Save Failed', 'Unable to send data: ' + (resp.message || 'Unknown error'));
      }
    });

    // Save and then show 10s loader then redirect if successful
    btnSaveAndRedirect.addEventListener('click', async ()=>{
      const data = collectFormData();

      if(!validatePostal(data.postal)){
        postalError.style.display = 'block';
        postalInput.classList.add('input-error');
        showModal('Postal Code Error', 'The postal code format appears invalid. Please correct it.');
        return;
      } else {
        postalError.style.display = 'none';
        postalInput.classList.remove('input-error');
      }

      const resp = await postToSheet({...data, action:'save_and_redirect'});
      if(resp && resp.status === 'ok'){
        // show loading 10 seconds then redirect
        await showLoadingForTenSeconds();
        window.location.href = REDIRECT_URL_AFTER_SUCCESS;
      } else {
        showModal('Save Failed', 'Unable to save data: ' + (resp.message || 'Unknown error'));
      }
    });

    // Optional: allow Enter key to submit Step1 -> Step2 if fields valid
    document.getElementById('contactForm').addEventListener('keydown', function(e){
      if(e.key === 'Enter'){
        const isStep1Visible = step1.style.display !== 'none';
        if(isStep1Visible){
          e.preventDefault();
          btnToStep2.click();
        }
      }
    });
  </script>
</body>

</html>
